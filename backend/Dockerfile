FROM node:16

RUN mkdir /usr/src/app
WORKDIR /usr/src/app

ENV PATH /usr/src/app/node_modules/.bin:$PATH
ARG APP_PORT=${APP_PORT}
ENV APP_PORT=${APP_PORT}
ARG DB_HOST=${DB_HOST}
ENV DB_HOST=${DB_HOST}
ARG DB_PORT=${DB_PORT}
ENV DB_PORT=${DB_PORT}
ARG DB_USER=${DB_USER}
ENV DB_USER=${DB_USER}
ARG DB_PASSWORD=${DB_PASSWORD}
ENV DB_PASSWORD=${DB_PASSWORD}
ARG DB_NAME=${DB_NAME}
ENV DB_NAME=${DB_NAME}
ARG DB_HOST_TEST=${DB_HOST_TEST}
ENV DB_HOST_TEST=${DB_HOST_TEST}
ARG DB_PORT_TEST=${DB_PORT_TEST}
ENV DB_PORT_TEST=${DB_PORT_TEST}
ARG DB_USER_TEST=${DB_USER_TEST}
ENV DB_USER_TEST=${DB_USER_TEST}
ARG DB_PASSWORD_TEST=${DB_PASSWORD_TEST}
ENV DB_PASSWORD_TEST=${DB_PASSWORD_TEST}
ARG DB_NAME=${DB_NAME}
ENV DB_NAME=${DB_NAME}
ARG CLIENT_URL=${CLIENT_URL}
ENV CLIENT_URL=${CLIENT_URL}
ARG ACCESS_JWT_SECRET=${ACCESS_JWT_SECRET}
ENV ACCESS_JWT_SECRET=${ACCESS_JWT_SECRET}
ARG ACCESS_JWT_EXPIRESIN=${ACCESS_JWT_EXPIRESIN}
ENV ACCESS_JWT_EXPIRESIN=${ACCESS_JWT_EXPIRESIN}
ARG REFRESH_JWT_SECRET=${REFRESH_JWT_SECRET}
ENV REFRESH_JWT_SECRET=${REFRESH_JWT_SECRET}
ARG REFRESH_JWT_EXPIRESIN=${REFRESH_JWT_EXPIRESIN}
ENV REFRESH_JWT_EXPIRESIN=${REFRESH_JWT_EXPIRESIN}
ARG REFRESH_JWT_COOKIE_MAXAGE=${REFRESH_JWT_COOKIE_MAXAGE}
ENV REFRESH_JWT_COOKIE_MAXAGE=${REFRESH_JWT_COOKIE_MAXAGE}
ARG REFRESH_JWT_COOKIE_SECURE=${REFRESH_JWT_COOKIE_SECURE}
ENV REFRESH_JWT_COOKIE_SECURE=${REFRESH_JWT_COOKIE_SECURE}

COPY package.json ./
RUN npm install

COPY ./index.js ./index.js
COPY ./migrate.js ./migrate.js
COPY ./database.sql ./database.sql
COPY ./src ./src
COPY ./tests ./tests 
COPY ./scripts ./scripts

CMD ["npm", "dev"]