services:
  backend:
    depends_on:
      - mysql
    build: ./backend
    environment:
      - APP_PORT=8000
      - NODE_ENV=test
      - DB_HOST_TEST=mysql
      - DB_USER_TEST=root
      - DB_PASSWORD_TEST=root
      - DB_NAME_TEST=amazon_clone_test
    ports:
      - 8000:8000
    healthcheck:
      test: [ "CMD-SHELL", "curl.sh || exit 0" ]
      interval: 10s
      timeout: 10s
      retries: 10
  mysql:
    image: mysql
    restart: always
    environment:
      - MYSQL_AUTHENTICATION_PLUGIN=mysql_native_password
      - MYSQL_ROOT_PASSWORD=root
    ports:
      - 127.0.0.1:3306:3306
